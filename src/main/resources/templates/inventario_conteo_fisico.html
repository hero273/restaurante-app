<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Gesti√≥n de Inventario - Comparaci√≥n</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
  <div class="container py-5">
    <h2 class="text-center mb-4 title-wayas">üì¶ Contraste de Inventario</h2>

    <div th:if="${mensajeExito}" class="alert alert-success alert-dismissible fade show" role="alert" th:text="${mensajeExito}">...</div>
    <div th:if="${mensajeError}" class="alert alert-danger alert-dismissible fade show" role="alert" th:text="${mensajeError}">...</div>

    <div class="card shadow">
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-bordered table-hover">
            <thead class="table-light">
              <tr>
                <th>Insumo</th>
                <th>Categor√≠a</th>
                <th>Stock Sistema</th>
                <th>Unidad</th>
                <th sec:authorize="hasAuthority('ADMIN')">Conteo F√≠sico</th>
                <th sec:authorize="hasAuthority('ADMIN')">Acci√≥n</th>
              </tr>
            </thead>
            <tbody>
              <tr th:if="${#lists.isEmpty(insumos)}">
                 <td colspan="6" class="text-center text-muted">No hay insumos para mostrar.</td>
              </tr>
              <tr th:each="ins : ${insumos}" th:classappend="${ins.stockActual != null and ins.stockMinimo != null and ins.stockActual.compareTo(ins.stockMinimo) <= 0} ? 'table-danger' : ''">
                <td th:text="${ins.descripcion}">Tomate</td>
                <td th:text="${ins.categoria}">Verduras</td>
                <td th:text="${#numbers.formatDecimal(ins.stockActual, 1, 'COMMA', 3, 'POINT')}">5.000</td>
                <td th:text="${ins.unidadMedida}">kg</td>
                
                <form th:action="@{/inventario/contrastar/actualizar}" method="post" class="d-contents" sec:authorize="hasAuthority('ADMIN')">
                    <input type="hidden" name="idInsumo" th:value="${ins.idInsumo}" />
                    <td>
                        <input type="number" step="0.001" name="conteoFisico" class="form-control form-control-sm" th:value="${#numbers.formatDecimal(ins.stockActual, 1, 'POINT', 3, 'POINT')}" required>
                    </td>
                    <td>
                        <button type="submit" class="btn btn-sm btn-warning">Actualizar</button>
                    </td>
                </form>
                
                <td colspan="2" sec:authorize="!hasAuthority('ADMIN')"></td>

              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    
    <div class="text-center mt-4">
      <a th:href="@{/gestion_inventario}" class="btn btn-secondary">‚¨Ö Volver a Gesti√≥n de Inventario</a>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>